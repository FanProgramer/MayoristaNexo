<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mayorista NexoTech</title>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* Puedes mover esto a style.css si prefer√≠s */
    .contenedor {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px;
    }

    .producto {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 10px;
      background-color: #fff;
      width: 250px;
      text-align: center;
    }

    .producto img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }

    .btn {
      background-color: #28a745;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn:hover {
      background-color: #218838;
    }

    #modalPedido {
      display: none; /* Oculto por defecto */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    .contenidoModal {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }
  </style>
</head>
<body>

  <nav>
  <a href="index.html">Inicio</a> | 
  <a href="contactos.html">Contacto</a>
</nav>


<header>
  <a href="#top"><img src="img/logo.png" alt="Mi Logo" /></a>
  <p class="leyenda-compra-minima">üõçÔ∏è Compra m√≠nima $250.000</p>
  <p>Usl: <span id="onlineCount">0</span></p>
</header>
  
<input type="text" id="buscador" placeholder="Buscar producto..." oninput="filtrarProductos()" />

<div class="contenedor" id="lista-productos">

  

  




<div id="productos"></div>



</div>



<div style="text-align: center; margin-top: 20px;">
  <button class="btn" onclick="mostrarPedido()">Ver pedido</button>
  <button class="btn" onclick="enviarPorWhatsapp()">Enviar pedido por WhatsApp</button>
</div>

<!-- Modal pedido -->
<div id="modalPedido">
  <div class="contenidoModal">
    <h2>Detalle del pedido</h2>
    <ul id="listaDetallePedido"></ul>
    <p>Total: $<span id="totalPedido">0</span></p>
    <button class="btn" onclick="cerrarPedido()">Cerrar</button>
    <button class="btn" onclick="enviarPorWhatsapp()">Confirmar y enviar pedido</button>
  </div>

<script>
  // Carrusel simple para todos los productos
  document.querySelectorAll('.carousel').forEach((carousel) => {
    const images = carousel.querySelectorAll('.carousel-image');
    let current = 0;

    setInterval(() => {
      images[current].classList.remove('active');
      current = (current + 1) % images.length;
      images[current].classList.add('active');
    }, 5000); // 5 segundos
  });
</script>


<div><span id="onlineCount"></span></div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { getDatabase, ref, set, onDisconnect, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCRW8nwRP-s8VgxurPtBUOiIvjqhK80rRs",
    authDomain: "contador-usuarios-24998.firebaseapp.com",
    databaseURL: "https://contador-usuarios-24998-default-rtdb.firebaseio.com",
    projectId: "contador-usuarios-24998",
    storageBucket: "contador-usuarios-24998.appspot.com",
    messagingSenderId: "192544535798",
    appId: "1:192544535798:web:1a30a552ee958274a828d7"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  signInAnonymously(auth)
    .then(() => {
      console.log("Sesi√≥n an√≥nima iniciada");
    })
    .catch((error) => {
      console.error("Error al autenticar:", error);
    });

  onAuthStateChanged(auth, (user) => {
    if (user) {
      const uid = user.uid;
      const userRef = ref(db, `onlineUsers/${uid}`);

      // Marcamos usuario conectado
      set(userRef, true);
      // Al desconectar, eliminamos
      onDisconnect(userRef).remove();

      const onlineUsersRef = ref(db, "onlineUsers");

      onValue(onlineUsersRef, (snapshot) => {
        const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
        document.getElementById("onlineCount").textContent = count;
      });
    }
  });
  
</script>

  
<script>
  fetch("https://raw.githubusercontent.com/FanProgramer/MayoristaNexo/master/productos.json")
    .then(res => res.json())
    .then(data => {
      const contenedor = document.getElementById("productos");
      const fragment = document.createDocumentFragment(); // ‚ö° Fragmento temporal

      const formatoPeso = new Intl.NumberFormat('es-AR', {
        style: 'currency',
        currency: 'ARS',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      });

      data.forEach((prod, index) => {
        const div = document.createElement("div");
        div.className = "producto";

        const rutaImagen = `img/${prod.codigo}.jpg`;
        let precioFormateado = "Consultar";
        let precioConAumento = 0;

        if (prod.precio) {
          const precioLimpio = parseFloat(
            String(prod.precio)
              .replace('$', '')
              .replace(/\s/g, '')
              .replace(/,/g, '')
          );

          if (!isNaN(precioLimpio) && precioLimpio > 0) {
            precioConAumento = Math.round(precioLimpio * 1.32);
            precioFormateado = formatoPeso.format(precioConAumento);
          }
        }

        const stock = prod.stock || 100;
        const idCantidad = `cantidad_${index}`;

        div.innerHTML = `
          <img src="${rutaImagen}" alt="${prod.codigo}" width="200" onerror="this.src='img/default.jpg'" />
          <h2>${prod.rubro}</h2>
          <p>${prod.descripcion || prod.codigo}</p>
          <p><strong>Precio:</strong> ${precioFormateado}</p>
          <p>Stock disponible!<span class="stock"> ${stock}</span></p>
          Cantidad:
          <input type="number" id="${idCantidad}" min="1" max="${stock}" value="1" style="width: 60px" />
          <button class="btn" onclick="agregarAlCarrito('${prod.descripcion || prod.codigo}', ${precioConAumento}, '${idCantidad}', ${stock})">Agregar al carrito</button>
          <button class="ver-pedido-btn">üõí Ver Pedido</button>
        `;

        fragment.appendChild(div); // ‚è±Ô∏è Arma todo en memoria
      });

      contenedor.appendChild(fragment); // ‚ö° Inserta todo de una sola vez
    })
    .catch(err => console.error("Error al cargar productos:", err));
</script>
  
<script src="js/app.js"></script>
</body>
</html>
